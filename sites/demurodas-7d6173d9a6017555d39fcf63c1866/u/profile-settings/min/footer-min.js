const displayNameHeading=document.getElementById("displayName"),firstNameInput=document.getElementById("firstName"),lastNameInput=document.getElementById("lastName"),emailInput=document.getElementById("email"),companyInput=document.getElementById("company"),americasRadio=document.getElementById("americas"),otherRadio=document.getElementById("other"),websiteInput=document.getElementById("website"),resaleInput=document.getElementById("resale"),submitButton=document.getElementById("submit");let displayName,firstName,lastName,email,company,americas,website,resale;firebase.auth().onAuthStateChanged((e=>{e?loadProfile():window.location.replace("/")}));const loadProfile=async()=>{try{console.log("Loading user profile...");const e=await firebase.auth().currentUser.getIdToken(!0),t=firebase.auth().currentUser,a=t.uid,r=await fetch(`${getProfileUrl}?token=${e}&id=${a}`);if(200!==r.status)throw r.status;{const e=await r.json(),a=JSON.parse(e);displayName=t.displayName,firstName=displayName.split(" ")[0],lastName=displayName.split(" ")[1],email=t.email,company=a.company,americas=!!a.americas,website=a.website?a.website:null,resale=a.resale?a.resale:null,displayNameHeading.innerText=displayName,firstNameInput.value=firstName,lastNameInput.value=lastName,emailInput.value=email,companyInput.value=company,americas?americasRadio.checked=!0:otherRadio.checked=!0,website&&(websiteInput.value=website),resale&&(resaleInput.value=resale),document.getElementById("waitingContainer").style.display="none"}}catch(e){Sentry.captureException(e)}},firstNameError=document.getElementById("firstNameError"),lastNameError=document.getElementById("lastNameError"),emailError=document.getElementById("emailError"),companyError=document.getElementById("companyError"),websiteError=document.getElementById("websiteError"),resaleError=document.getElementById("resaleError"),formError=document.getElementById("globalError"),saveProfile=()=>{clearErrors(),validateForm()&&postData()};submitButton.addEventListener("click",saveProfile),document.body.addEventListener("keyup",(e=>{13!==e.keyCode&&13!==e.which||submitButton.click()}));const validateForm=()=>{let e=0;return validateString(firstNameInput.value)||(firstNameError.classList.add("input_label_error"),firstNameError.innerText="Please enter a valid first name",firstNameInput.classList.add("input_field_error"),e++),validateString(lastNameInput.value)||(lastNameError.classList.add("input_label_error"),lastNameError.innerText="Please enter a valid last name",lastNameInput.classList.add("input_field_error"),e++),validateEmail(emailInput.value)||(emailError.classList.add("input_label_error"),emailError.innerText="Please enter a valid email",emailInput.classList.add("input_field_error"),e++),validateString(companyInput.value)||(companyError.classList.add("input_label_error"),companyError.innerText="Please enter a valid company name",companyInput.classList.add("input_field_error"),e++),validateWebsite(websiteInput.value)||(websiteError.classList.add("input_label_error"),websiteError.innerText="Please enter a valid website",websiteInput.classList.add("input_field_error"),e++),0===e&&(console.log("Validation passed"),!0)},clearErrors=()=>{firstNameError.classList.remove("input_label_error"),firstNameError.innerText="First name",firstNameInput.classList.remove("input_field_error"),lastNameError.classList.remove("input_label_error"),lastNameError.innerText="Last name",lastNameInput.classList.remove("input_field_error"),emailError.classList.remove("input_label_error"),emailError.innerText="Email address",emailInput.classList.remove("input_field_error"),companyError.classList.remove("input_label_error"),companyError.innerText="Company",companyInput.classList.remove("input_field_error"),websiteError.classList.remove("input_label_error"),websiteError.innerText="Website",websiteInput.classList.remove("input_field_error"),formError.style.display="none"},formSuccess=document.getElementById("formSuccess"),urlParams=new URLSearchParams(window.location.search),success=urlParams.get("success");success&&(formSuccess.style.display="block",setTimeout((()=>{formSuccess.style.display="none"}),1e4),window.history.pushState({},document.title,window.location.pathname));const postData=async()=>{try{submitButton.removeEventListener("click",saveProfile),submitButton.value="Please wait...";const e={token:await firebase.auth().currentUser.getIdToken(),firstName:firstNameInput.value,lastName:lastNameInput.value,email:emailInput.value,company:companyInput.value,americas:americasRadio.checked,website:websiteInput.value,resale:resaleInput.value},t=await fetch(updateProfileUrl,{method:"POST",body:JSON.stringify(e)});if(200!==t.status)throw t.status;emailInput.value!==email?window.location.replace(`/u/sign-in?email=${emailInput.value}`):window.location.href+="?success=true"}catch(e){submitButton.value="Submit",submitButton.addEventListener("click",saveProfile),Sentry.captureException(e),formError.style.display="block"}};